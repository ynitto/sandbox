---
name: requirements-definer
description: ユーザーとの対話を通じて要件リストを作成し、requirements.json として出力する。「要件定義して」「やりたいことを整理して」「要件をまとめて」「受け入れ条件を定義して」「何を作るか決めたい」「ユーザーストーリーを書いて」「ストーリーマッピングして」などのリクエストで発動する。
metadata:
  version: "2.0"
---

# requirements-definer

ユーザーとの対話を通じて要件リストを作成し、`requirements.json` に出力する。プロジェクトの規模に応じてユーザーストーリー、ストーリーマッピング、MoSCoW 優先度付けなどのアジャイル手法を使い分ける。

**このスキルの責務はここまで。** 出力後の計画立案・タスク分解・実行は行わない。

## ワークフロー

### Step 1: 前提を確認する

対象ユーザー、利用シーン、対象範囲をユーザーに質問して確認する。

> **確認例**: 「このアプリは誰が使いますか？個人利用ですか、チーム共有ですか？」

### Step 2: 規模判定

ユーザーの回答とプロンプトから、プロジェクトの規模を判定する。以降の Step で使用する手法を決定する。

| 規模 | 判定基準 | 使用する手法 |
|------|---------|-------------|
| **小規模** | 機能数3以下、単一ユーザー種別、明確なゴール | Tier 1（ユーザーストーリー + 受け入れ条件） |
| **中〜大規模** | 機能数4以上、複数ユーザー種別、スコープが広い | Tier 2（ストーリーマッピング + MoSCoW）を追加 |
| **不明** | ユーザーに確認する | 「シンプルに進めますか？（Tier 1）じっくり整理しますか？（Tier 2）」 → 回答に応じて Tier を決定 |

### Step 3: やりたいことを要件に分解する

**中〜大規模（Tier 2）と判定した場合は、まず Step 3-2 のストーリーマッピングを実施してから Step 3-1 に進む。小規模（Tier 1）の場合は Step 3-1 から直接始める。**

#### Tier 2: ストーリーマッピング + MoSCoW（中〜大規模で先に実施）

Step 2 で中〜大規模と判定した場合、ユーザーストーリーマッピングを実施して全体像を把握してから、各ストーリーを Tier 1 の形式に展開する。

**1. ユーザーフローを定義する**

ユーザーの行動を大ステップ（アクティビティ）で時系列に並べる:

```
ユーザーフロー:
[1. 商品を探す] → [2. カートに入れる] → [3. 決済する] → [4. 配送を確認する]
```

**2. 各ステップのストーリーを MoSCoW で優先度付けする**

```
ストーリーマップ:

1. 商品を探す
   Must:   キーワード検索、カテゴリ閲覧
   Should: フィルタリング、ソート
   Could:  AIレコメンド

2. カートに入れる
   Must:   商品追加、数量変更、カート一覧
   Should: お気に入り保存
   Could:  まとめ買い割引表示

3. 決済する
   Must:   クレジットカード決済
   Should: コンビニ払い
   Could:  ポイント利用

4. 配送を確認する
   Must:   注文履歴、配送状況表示
   Should: メール通知
   Could:  配送日時変更
```

**3. MoSCoW → priority マッピング**

ストーリーマップの分類は requirements.json の `moscow` フィールドと `priority` に反映される:
- **Must** → `moscow: "must"`, scrum-master で priority 1
- **Should** → `moscow: "should"`, scrum-master で priority 2
- **Could** → `moscow: "could"`, scrum-master で priority 3
- **Won't** → `scope.out` に記録（バックログに含めない）

ストーリーマップの各ストーリーを Tier 1 のユーザーストーリー形式で機能要件に展開する。

#### Tier 1: ユーザーストーリー形式（常に使用）

機能要件は「As a [ユーザー], I want [機能], so that [価値]」形式で記述する。非機能要件は従来通り。

**機能要件の例:**

| # | 要件名 | ユーザーストーリー |
|---|--------|-------------------|
| F-01 | TODO作成 | As a 個人ユーザー, I want タイトル・期限・優先度を指定してTODOを登録する, so that やるべきことを忘れずに管理できる |
| F-02 | ステータス管理 | As a 個人ユーザー, I want TODO/進行中/完了のステータスを切り替える, so that 作業の進捗を把握できる |
| F-03 | 一覧表示 | As a 個人ユーザー, I want ステータス・優先度でフィルタリングして一覧表示する, so that 必要なタスクをすぐ見つけられる |

**非機能要件の例:**

| # | 要件名 | 内容 |
|---|--------|------|
| N-01 | レスポンス | API応答は95パーセンタイルで500ms以内 |
| N-02 | 可用性 | 月次稼働率99.5%以上 |

### Step 4: スコープを確定する

In/Out を明記してユーザーと合意する。Tier 2 使用時は MoSCoW の Won't が自動的に Out になる。

**スコープ表の例:**

| 機能 | In/Out | 備考 |
|------|--------|------|
| TODO CRUD | In | 基本4操作すべて |
| チーム共有・権限管理 | Out | v2以降で検討 |
| モバイルアプリ | Out | Webのみ対応 |
| メール通知 | Out | 今回は対象外 |

### Step 5: 受け入れ条件を定義する

Given/When/Then 形式で各機能要件に対して定義する。

**受け入れ条件の例 (F-01):**

```
Given: ユーザーがログイン済みである
When:  タイトル「買い物」・期限「2025-03-01」・優先度「高」を入力して送信する
Then:  TODOが一覧に追加され、ステータスが「TODO」で表示される
       AND タイトルが空の場合はバリデーションエラーが表示される
```

### Step 6: （オプション）カスタマージャーニーマップ

BtoC プロダクトや UX 重視のプロジェクトで、ユーザーが希望した場合に実施する。

**実施判断**: Step 1 で対象ユーザーが「エンドユーザー（消費者）」かつ「ユーザー体験の全体設計が必要」な場合に提案する。

```
カスタマージャーニーマップを作成しますか？
- BtoCプロダクトやUXを重視する場合に有効です
- ユーザーの行動・感情・課題を可視化して要件の抜け漏れを防ぎます
```

**ジャーニーマップのテンプレート:**

| フェーズ | 行動 | 感情 | タッチポイント | 課題 |
|---------|------|------|--------------|------|
| 認知 | SNS広告を見る | 興味 | Instagram | 何ができるか不明 |
| 検討 | LPを見る | 期待 | Web | 料金が分かりにくい |
| 利用 | 商品を注文する | 不安 | アプリ | 配送状況が見えない |
| 継続 | リピート購入 | 満足/不満 | メール | 通知が多すぎる |

各「課題」から機能要件を導出し、Step 3 の要件リストに追加する。

### Step 7: （オプション）ペルソナ定義

複数のユーザー種別が存在する場合に実施する。

**実施判断**: Step 1 で2種類以上のユーザー種別が判明した場合に提案する。

```
複数のユーザー種別があるようです。ペルソナを定義しますか？
- ユーザーストーリーの「As a」の部分を具体化できます
- 優先すべきユーザーの判断に役立ちます
```

**ペルソナのテンプレート:**

| 項目 | 内容 |
|------|------|
| ID | P-01 |
| 名前 | 田中太郎（仮名） |
| 属性 | 30代、会社員、ITリテラシー中程度 |
| 動機 | 日々のタスクを効率的に管理したい |
| 課題 | 既存ツールが多機能すぎて使いこなせない |

定義したペルソナの ID を各機能要件の `persona` フィールドに紐付ける。

### Step 8: requirements.json に出力して終了する

作業ディレクトリのルートに `requirements.json` を保存する。スキーマは [references/requirements-schema.md](references/requirements-schema.md) を参照する。

**出力後はユーザーに完了を通知して終了する。** それ以上の処理（計画立案・タスク分解・実行）は行わない。

```
要件定義が完了しました。requirements.json を出力しました。
```
