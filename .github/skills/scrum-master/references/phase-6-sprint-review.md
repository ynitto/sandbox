# Phase 6: スプリントレビュー & レトロスペクティブ

> **開始時出力**: `=== PHASE 6: スプリントレビュー 開始 ===`

スプリント内の全タスク完了後（またはユーザーが中断を選択後）、レビュー・フィードバック収集・スキル評価を順に行う。

> **役割分担**:
> - **サブエージェントに委譲する**: レビュー計算・評価スクリプト実行・フィードバック記録など、処理・実行系の作業
> - **scrum-master が直接行う**: フィードバック収集・スキル評価結果の提示・ユーザーへの確認など、ユーザーとの対話
>
> VSCode Copilot ではサブエージェントがユーザーと対話できないため、この役割分担を厳守すること。
> - **GitHub Copilot (VSCode)**: `#tool:agent/runSubagent` を使用
> - **Claude Code**: `Task` ツールを使用

## 手順

### Step 1: スプリントレビュー

**サブエージェントを起動する**（テンプレート: `subagent-templates.md`「スプリントレビュー時」を使用）:
```
sprint-reviewer スキルでスプリントのレビューとレトロスペクティブを実施する。

手順: まず ${SKILLS_DIR}/sprint-reviewer/SKILL.md を読んで手順に従ってください。
ゴール: [goal]
スプリント番号: [N]
スプリント計画:
- [計画時に選択したタスクと優先度の要約]
実行ログサマリー:
- [予定どおり進んだ点 / 遅延・失敗が出た点]
タスク一覧:
- [task-id]: action=[action], done_criteria=[done_criteria], status=[status], result=[result]
- ...

結果を以下の形式で返してください:
レビュー: [ゴール進捗の評価 1〜2文]
進め方レビュー: [スプリントプランと実行プロセスの評価 1〜2文]
レトロスペクティブ: [改善点 1〜2文]
次スプリント反映アクション:
- [改善アクション1]
- [改善アクション2]
ブロッカー: [あれば列挙、なければ「なし」]
```

結果をパースして `plan.json` に格納する:
- `レビュー:` → sprints の `review`
- `進め方レビュー:` → sprints の `process_review`
- `レトロスペクティブ:` → sprints の `retro`
- `次スプリント反映アクション:` → sprints の `next_sprint_actions`（配列）
- `ブロッカー:` → sprints の `impediments`（「なし」の場合は空配列）

### Step 2: スキルフィードバック収集

このスプリントで実行したスキルのフィードバックを収集する。skill が指定され completed になったタスクからスキル名を重複なく抽出する。

**Step 2-1: scrum-master 自身がユーザーに一括確認する**（サブエージェントへの委譲ではなく、scrum-master 直接）:

```
このスプリントで使用したスキルのフィードバックを収集します。

- [skill-name1]: 1. 問題なかった (ok) / 2. 改善点がある (needs-improvement) / 3. うまくいかなかった (broken)
- [skill-name2]: ...
```

**Step 2-2: フィードバックを記録するサブエージェントを起動する**（テンプレート: `subagent-templates.md`「スキルフィードバック収集時」を使用）。
Step 2-1 で収集した verdict と note をテンプレートの「フィードバック:」欄に埋め込んで渡すこと。

### Step 3: スキル評価

**Step 3-1: 評価サブエージェントを起動する**（テンプレート: `subagent-templates.md`「スキル評価時」を使用）。
skill-evaluator はレポートのみ返す（ユーザー確認・promote/refine の実行は行わない）。

**Step 3-2: scrum-master 自身が評価結果をユーザーに提示し、アクションを確認する**:

サブエージェントから受け取った評価結果をもとに、scrum-master が直接ユーザーに確認する:
```
スキル評価結果:
[skill-evaluator から受け取った評価結果を表示]

昇格推奨スキルがある場合:
「[skill-name] を昇格しますか？（~/.copilot/skills/ にコピーされます）
 1. 昇格する / 2. 後で / 3. スキップ」

要改良スキルがある場合:
「[skill-name] に改善待ちのフィードバックがあります。
 1. 今すぐ改良する / 2. 後で / 3. スキップ」
```

**Step 3-3: ユーザーが承認したアクションのみサブエージェントへ委譲する**:
- 昇格 → テンプレート: `subagent-templates.md`「スキル昇格時」を使用
- 改良 → テンプレート: `subagent-templates.md`「スキル改良時」を使用

### Step 4: スキル発見（任意）

今スプリントで新しいスキルが作成された場合に、**scrum-master 自身が**ユーザーに提案する:
```
最近のチャット履歴から新しいスキル候補を発見できるかもしれません。
git-skill-manager discover を実行しますか？ [y/N]
```
- 「はい」→ **サブエージェントを起動する**（テンプレート: `subagent-templates.md`「スキル発見時」を使用）
- 結果を review フィールドに追記する

## ゲート条件（Phase 7 に進む前に確認）

- [ ] スプリントレビュー（Step 1）が完了し、plan.json に結果が格納されている
- [ ] フィードバック収集（Step 2）が完了している
- [ ] スキル評価（Step 3）が完了している

→ 条件を満たしたら **Phase 7: 進捗レポートと継続判断** へ進む
