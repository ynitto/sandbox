# Phase 3: スキルギャップ解決

**前提確認**: `plan.json` が存在すること。存在しない場合は Phase 2 に戻る。

バックログを精査し、スキルの新規作成・改良が必要なケースを検出する。

**ガードレール**: Phase 3 内でのスキル作成/改良 → Phase 1 再実行は **最大2回** まで。超えた場合はユーザーに「残りのスキルギャップは手動で解決するか、スキルなしで進めるか」を確認する。

## 3a: スキル不足（skill: null だがスキルが必要）

1. ユーザーに報告する:
   ```
   以下のタスクに対応するスキルがありません:
   - [タスク内容]

   選択肢:
   1. 新しいスキルを作成する（skill-creatorを使用）
   2. 既存コードベースからスキルを生成する（codebase-to-skillを使用）
   3. 外部URLからスキルを取り込む（skill-recruiterを使用）
   4. スキルなしで実行を試みる
   5. このタスクをスキップする
   ```
2. ユーザーが「作成する」を選んだ場合:
   - サブエージェントを起動する（Claude Code: Task ツール / GitHub Copilot: `#tool:agent/runSubagent`）（テンプレート「スキル作成時」を使用）
   - 完了後、Phase 1を再実行してスキル一覧を更新する
   - バックログのskillフィールドを新スキル名で更新する
3. ユーザーが「コードベースから生成する」を選んだ場合:
   - 対象コードベースのパスをユーザーに確認する
   - サブエージェントを起動する（Claude Code: Task ツール / GitHub Copilot: `#tool:agent/runSubagent`）（テンプレート「コードベースからスキル生成時」を使用）
   - 完了後、Phase 1を再実行してスキル一覧を更新する
   - バックログのskillフィールドを新スキル名で更新する
4. ユーザーが「外部URLから取り込む」を選んだ場合:
   - スキルのGitリポジトリURLをユーザーに確認する
   - サブエージェントを起動する（Claude Code: Task ツール / GitHub Copilot: `#tool:agent/runSubagent`）（テンプレート「スキル招募時」を使用）
   - 完了後、Phase 1を再実行してスキル一覧を更新する
   - バックログのskillフィールドを新スキル名で更新する

## 3b: 既存スキルの改良（機能追加・改善・分割を含む）

タスクに割り当てたスキルが要件を十分に満たさない場合（機能不足・手順の改善・責務が広すぎて分割が必要等）:

1. ユーザーに報告する:
   ```
   スキル [skill-name] は存在しますが、改良が必要です:
   - [不足点・改善点・分割の必要性]

   選択肢:
   1. スキルを改良してから実行する（skill-creatorを使用）
   2. 既存コードベースを分析してスキルを補強する（codebase-to-skillを使用）
   3. 現状のスキルのまま実行を試みる
   4. このタスクをスキップする
   ```
2. ユーザーが「改良する」を選んだ場合:
   - サブエージェントを起動する（Claude Code: Task ツール / GitHub Copilot: `#tool:agent/runSubagent`）（テンプレート「スキル改良時」を使用）
   - 完了後、Phase 1を再実行してスキル一覧を更新する
   - 分割により新スキルが生まれた場合、バックログ内の旧スキル参照を新スキル名で更新する
3. ユーザーが「コードベースから補強する」を選んだ場合:
   - 参考にするコードベースのパスをユーザーに確認する
   - サブエージェントを起動する（Claude Code: Task ツール / GitHub Copilot: `#tool:agent/runSubagent`）（テンプレート「コードベースからスキル生成時」を使用。既存スキルの改良である旨と不足点を併せて渡す）
   - 完了後、Phase 1を再実行してスキル一覧を更新する
   - バックログのskillフィールドを更新後のスキル名で更新する

**▶ Phase 3 完了チェック（必須）**: スキルギャップが残っていないことを確認し、`plan.json` の `current_phase` を 3 に更新してから Phase 4 へ進む。スキルが不足しているタスクがある場合は、ユーザーの選択（スキップ/作成/既存スキルで代替）が完了してから進む。
