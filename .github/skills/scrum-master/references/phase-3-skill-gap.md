# Phase 3: スキルギャップ解決

> **開始時出力**: `=== PHASE 3: スキルギャップ解決 開始 ===`

**前提確認**: `plan.json` が存在すること。存在しない場合は Phase 2 に戻る。

バックログを精査し、スキルの新規作成・改良が必要なケースを検出する。

> **委譲必須**: このフェーズのスキル作成・改良・招募は全て**サブエージェントに委譲すること**。スクラムマスター自身がスキルファイルを作成・編集してはならない。
> - **GitHub Copilot (VSCode)**: `#tool:agent/runSubagent` を使用
> - **Claude Code**: `Task` ツールを使用

**ガードレール**: Phase 3 内でのスキル作成/改良 → Phase 1 再実行は **最大2回** まで。超えた場合はユーザーに「残りのスキルギャップは手動で解決するか、スキルなしで進めるか」を確認する。

## 3a: スキル不足（skill: null だがスキルが必要）

1. ユーザーに報告する:
   ```
   以下のタスクに対応するスキルがありません:
   - [タスク内容]

   選択肢:
   1. 新しいスキルを作成する（skill-creatorを使用）
   2. 既存コードベースからスキルを生成する（codebase-to-skillを使用）
   3. 外部URLからスキルを取り込む（skill-recruiterを使用）
   4. スキルなしで実行を試みる
   5. このタスクをスキップする
   ```
2. ユーザーが「作成する」を選んだ場合:
   - **サブエージェントを起動する**（テンプレート: `subagent-templates.md`「スキル作成時」を使用）
   - 完了後、Phase 1 のスキル探索コマンドを再実行してスキル一覧を更新する
   - バックログの skill フィールドを新スキル名で更新する
3. ユーザーが「コードベースから生成する」を選んだ場合:
   - 対象コードベースのパスをユーザーに確認する
   - **サブエージェントを起動する**（テンプレート: `subagent-templates.md`「コードベースからスキル生成時」を使用）
   - 完了後、Phase 1 を再実行 → バックログ更新
4. ユーザーが「外部URLから取り込む」を選んだ場合:
   - スキルのGitリポジトリURLをユーザーに確認する
   - **サブエージェントを起動する**（テンプレート: `subagent-templates.md`「スキル招募時」を使用）
   - 完了後、Phase 1 を再実行 → バックログ更新

## 3b: 既存スキルの改良（機能追加・改善・分割を含む）

タスクに割り当てたスキルが要件を十分に満たさない場合:

1. ユーザーに報告する:
   ```
   スキル [skill-name] は存在しますが、改良が必要です:
   - [不足点・改善点・分割の必要性]

   選択肢:
   1. スキルを改良してから実行する（skill-creatorを使用）
   2. 既存コードベースを分析してスキルを補強する（codebase-to-skillを使用）
   3. 現状のスキルのまま実行を試みる
   4. このタスクをスキップする
   ```
2. ユーザーが「改良する」を選んだ場合:
   - **サブエージェントを起動する**（テンプレート: `subagent-templates.md`「スキル改良時」を使用）
   - 完了後、Phase 1 を再実行 → バックログ更新
3. ユーザーが「コードベースから補強する」を選んだ場合:
   - **サブエージェントを起動する**（テンプレート: `subagent-templates.md`「コードベースからスキル生成時」を使用。既存スキルの改良である旨と不足点を併せて渡す）
   - 完了後、Phase 1 を再実行 → バックログ更新

## ゲート条件（Phase 4 に進む前に確認）

- [ ] スキルギャップが残っていない（全タスクにスキルが割り当て済み、またはユーザーがスキップ/スキルなし実行を承認済み）
- [ ] `plan.json` の `current_phase` を 3 に更新した

→ 条件を満たしたら **Phase 4: スプリントプランニング** へ進む
