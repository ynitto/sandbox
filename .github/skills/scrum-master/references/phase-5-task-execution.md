# Phase 5: タスク実行

スプリント内のタスクをウェーブ単位で実行する。同一ウェーブ内のタスクは並列にサブエージェントへ委譲し、ウェーブ間は直列で進行する。

## 実行フロー

```
Wave 1: [b1, b2] → 並列実行 → 全完了を待機
         ↓
Wave 2: [b3, b4] → 並列実行 → 全完了を待機
         ↓
Wave 3: [b5]     → 単独実行
```

## 手順

`execution_groups` の各ウェーブを順に処理する:

1. **ウェーブ開始**: ウェーブ内の全タスクのstatusを `in_progress` に更新する
2. **並列起動**: ウェーブ内の全タスクについてサブエージェントを**同時に**起動する（Claude Code: Task ツールを複数同時呼び出し / GitHub Copilot: `#tool:agent/runSubagent` を複数同時呼び出し）
   - **skill指定ありの場合** は該当スキルの SKILL.md をサブエージェントに読み込ませる
   - **skill: null の場合** は該当スキルを指定しない。skill: null で許可する作業は「情報の調査・確認」「ユーザーへの判断依頼」「ファイルの読み取り・軽微な編集」に限定する
   - タスクのactionとコンテキスト（先行タスクのresult）をプロンプトとして渡す
   - **注意**: ウェーブ1ではコンテキストは前スプリントの結果のみ。ウェーブ2以降は前ウェーブの結果をコンテキストに含める
3. **結果収集**: 全サブエージェントの完了を待ち、各タスクのresultフィールドに結果を記録する
4. **完了判定**: 各タスクのdone_criteriaに照らして判定する:
   - 満たす → status: `completed`
   - 満たさない → status: `failed`、理由をresultに記録
5. **ウェーブ内失敗時の判断**:
   - 失敗タスクに後続ウェーブのタスクが依存している場合 → ユーザーに報告する（下記テンプレート）
   - 失敗タスクに依存するタスクがない場合 → 報告のみで次のウェーブへ進む
6. **次のウェーブへ**: 前ウェーブの結果を踏まえて次ウェーブを実行する。依存先が失敗したタスクはスキップする（status: `skipped`）

## 並列実行の制約

- 同一ファイルを編集するタスクが同一ウェーブに含まれる場合、コンフリクト防止のためウェーブを分割する（Phase 4 で考慮すること）
- ユーザーへの対話的な確認が必要なタスク（skill: null）は単独ウェーブに分離することを推奨する

## タスク失敗時の報告テンプレート

```
Wave [N] 実行結果:
- [id]: 完了 ✓
- [id]: 失敗 ✗ — [理由]

失敗タスクに依存する後続タスク: [ids]

選択肢:
1. 失敗タスクをリトライする（後続タスクは待機）
2. 失敗タスクをスキップし、依存タスクもスキップする
3. スプリントを中断する
```
