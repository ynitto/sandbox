---
name: code-reviewer
description: コードレビューを実施するスキル。「コードをレビューして」「このコードの問題点を教えて」「レビューお願い」「コードチェックして」「品質確認して」などのリクエストで発動する。特定の言語に依存せず、ユーザーが提供するコーディングルールを優先して適用する。
---

# code-reviewer

言語非依存のコードレビューを実施する。ユーザーが提供するコーディングルールを最優先に適用し、普遍的な品質観点で問題を指摘する。

## コーディングルールの扱い

ユーザーがコーディングルールを提供した場合、そのルールをレビューの最優先基準とする。

- ルールが明示されていれば、それに準拠しているかを最初に確認する
- ルールが曖昧な場合は、意図を確認してからレビューを進める
- ルールがない場合は、以下の汎用観点でレビューする

## レビューワークフロー

### Step 1: 対象とルールを把握する

レビュー開始前に以下を確認する:

1. **対象コードの役割** — このコードは何をするものか
2. **ユーザー提供のコーディングルール** — 明示されたルール・規約があるか
3. **レビューの深度** — 全体的な品質確認か、特定箇所の集中確認か

コーディングルールがない場合は先に進む。コードの目的が不明な場合は質問する。

### Step 2: ユーザー定義ルールへの適合を確認する

ユーザーが提供したルールがある場合:

- ルールごとに違反箇所を特定する
- 違反の具体的な場所（ファイル名・行番号）を示す
- 違反の理由と改善案を提示する

### Step 3: 汎用観点でレビューする

以下のカテゴリで問題を確認する:

#### 正確性
- ロジックの誤り（条件分岐・ループ・境界値）
- 意図していない副作用
- 未処理のエラー・例外
- データの整合性が崩れるケース

#### 可読性・保守性
- 変数名・関数名が意図を正確に表しているか
- 関数・クラスの責務が単一か（過度な複雑さがないか）
- マジックナンバー・ハードコードされた値
- コメントの適切さ（なぜその実装かが伝わるか）

#### 堅牢性
- 入力値のバリデーション（特に外部入力）
- エッジケース・境界値の考慮
- リソースの適切な解放（ファイル・接続など）
- タイムアウト・リトライの考慮

#### セキュリティ
- インジェクション（SQL・コマンド・テンプレートなど）のリスク
- 認証・認可の抜け
- 機密情報のハードコードやログ出力
- 外部入力の無検証利用

#### パフォーマンス
- 不必要な繰り返し処理・重複した計算
- N+1問題など非効率なデータアクセスパターン
- 不要なメモリ確保

#### テスト容易性
- テストが書きにくい構造になっていないか
- 依存関係が注入可能か
- 副作用が隔離されているか

### Step 4: 結果を報告する

#### 重要度の分類

| 重要度 | 意味 | 対応 |
|--------|------|------|
| **Critical** | バグ・セキュリティ問題・データ破壊の恐れ | 必ず修正 |
| **Warning** | 将来の障害につながるリスク・設計上の問題 | 修正を強く推奨 |
| **Suggestion** | 可読性・保守性の改善案 | 検討を推奨 |

#### 報告フォーマット

```
## レビュー結果

### ユーザー定義ルールへの適合
（ルールがある場合のみ）

[ルール名]: ✅ 適合 / ❌ 違反
違反箇所: <場所>
問題: <説明>
改善案: <提案>

### 指摘事項

#### 🔴 Critical
**[カテゴリ] <問題の要約>**
場所: <ファイル名・行番号・関数名など>
問題: <何が問題か>
改善案:
<修正後のコード例または手順>

#### 🟡 Warning
...（同形式）

#### 🔵 Suggestion
...（同形式）

### サマリー
- Critical: X件
- Warning: X件
- Suggestion: X件

<総評: コード全体の品質・特に良い点・改善の優先順位>
```

## レビューの原則

- **指摘は具体的に** — 「良くない」ではなく「なぜ問題で、どう直すか」を示す
- **文脈を尊重する** — ユーザーのルールや制約を無視した理想論は押し付けない
- **良い点も伝える** — 改善点だけでなく、適切に実装されている部分も言及する
- **優先度を明確に** — Critical から対処するよう促す
- **根拠を示す** — なぜそれが問題かを説明する
